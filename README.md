# سرویس مدیریت کاربران و احراز هویت با OTP در Golang

سرویس بک‌اند توسعه‌یافته با زبان Go برای مدیریت کاربران و احراز هویت مبتنی بر کد یک‌بار مصرف (OTP). این سیستم با استفاده از PostgreSQL و Docker پیاده‌سازی شده است.

## ✨ ویژگی‌های اصلی
- **احراز هویت با OTP**: تولید و اعتبارسنجی کد یک‌بار مصرف برای ورود
- **تولید توکن JWT**: صدور توکن امنیتی پس از احراز هویت موفق
- **محدودیت نرخ درخواست**: جلوگیری از سوءاستفاده با محدود کردن درخواست‌های OTP
- **مدیریت کاربران**:
    - دریافت اطلاعات کاربر خاص
    - دریافت لیست کاربران با قابلیت‌های صفحه‌بندی و جستجو
- **محیط کانتینری**: راه‌اندازی آسان با Docker Compose

## 🏗️ معماری پروژه
ساختار پروژه مبتنی بر معماری تمیز (Clean Architecture):

```
cmd/
└── main.go          # نقطه ورود برنامه

internal/
├── api/             # هندلرهای HTTP و روتر
├── user/            # سرویس‌ها و ریپوزیتوری کاربران
├── otp/             # منطق تولید و اعتبارسنجی OTP
├── jwt/             # مدیریت توکن‌های JWT
└── middleware/      # میان‌افزارها

pkg/
└── database/        # مدیریت اتصال به پایگاه داده
```

## 🚀 راه‌اندازی پروژه

### پیش‌نیازها
- Docker
- Docker Compose

### مراحل اجرا
1. کلون کردن مخزن:
```bash
git clone https://github.com/amingeek/user-go.git
cd user-go
```

2. اجرای سرویس‌ها:
```bash
docker-compose up --build
```

3. پس از اجرا، سرور روی پورت 8080 در دسترس خواهد بود:
```
Server is running on port 8080...
```

## 🔍 راهنمای استفاده از API

### 1. درخواست کد OTP
```bash
curl -X POST http://localhost:8080/otp/request \
  -H "Content-Type: application/json" \
  -d '{"phone_number": "+989123456789"}'
```

### 2. ورود با کد OTP
```bash
curl -X POST http://localhost:8080/otp/login \
  -H "Content-Type: application/json" \
  -d '{"phone_number": "+989123456789", "otp": "123456"}'
```

### 3. دریافت اطلاعات کاربر (نیازمند توکن)
```bash
TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
curl -X GET http://localhost:8080/users/1 \
  -H "Authorization: Bearer $TOKEN"
```

### 4. دریافت لیست کاربران (نیازمند توکن)
```bash
TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
curl -X GET http://localhost:8080/users \
  -H "Authorization: Bearer $TOKEN"
```

## 🗄️ توجیه انتخاب پایگاه داده
**PostgreSQL** به دلایل زیر انتخاب شده است:
- **پایداری و قابلیت اطمینان**: عملکرد اثبات‌شده در حجم بالای داده‌ها
- **انعطاف‌پذیری**: پشتیبانی از انواع داده‌های پیشرفته و پیچیده
- **سازگاری با کانتینر**: راه‌اندازی آسان با Docker
- **امنیت**: مکانیزم‌های احراز هویت و دسترسی پیشرفته

## 💡 نکات فنی
- کدهای OTP در محیط توسعه در کنسول نمایش داده می‌شوند
- توکن‌های JWT با عمر محدود تولید می‌شوند
- محدودیت نرخ: حداکثر ۳ درخواست OTP در ۱۰ دقیقه برای هر شماره
- از الگوی Repository برای جداسازی لایه دسترسی به داده‌ها استفاده شده است