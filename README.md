# سرویس مدیریت کاربران و احراز هویت با OTP در Golang

این پروژه یک سرویس بک‌اند (backend) در زبان برنامه‌نویسی Go است که قابلیت‌های اصلی مدیریت کاربران و احراز هویت مبتنی بر کد یک‌بار مصرف (OTP) را پیاده‌سازی می‌کند. این سرویس با استفاده از پایگاه داده PostgreSQL و داکر (Docker) توسعه داده شده است.

## ویژگی‌های اصلی پروژه

- **احراز هویت با OTP**: کاربر شماره تلفن خود را ارسال می‌کند، سیستم یک کد OTP تولید کرده و برای ورود به سیستم از آن استفاده می‌شود.
- **تولید توکن JWT**: پس از احراز هویت موفق، یک توکن JWT به کاربر بازگردانده می‌شود.
- **محدودیت نرخ (Rate Limiting)**: درخواست‌های OTP محدود شده‌اند تا از سوءاستفاده جلوگیری شود.
- **مدیریت کاربران**: مسیرهای REST برای دریافت اطلاعات یک کاربر خاص و همچنین دریافت لیست کاربران با قابلیت‌های صفحه‌بندی (Pagination) و جستجو وجود دارد.
- **محیط کانتینری**: کل پروژه به همراه پایگاه داده PostgreSQL با استفاده از Docker Compose راه‌اندازی می‌شود.

## معماری و ساختار پروژه

پروژه از یک معماری تمیز و لایه‌ای (Clean Architecture) پیروی می‌کند تا تفکیک مسئولیت‌ها به صورت واضحی انجام شود:

- **`cmd/`**: حاوی نقطه شروع برنامه (`main.go`).
- **`internal/api/`**: شامل هندلرهای HTTP، روتر و میان‌افزارهای (middleware) API.
- **`internal/user/`**: حاوی منطق اصلی کسب‌وکار (Service) و لایه ارتباط با دیتابیس (Repository) برای مدیریت کاربران.
- **`internal/otp/`**: پیاده‌سازی منطق تولید و اعتبارسنجی OTP و محدودیت نرخ درخواست‌ها.
- **`internal/jwt/`**: مسئول تولید و مدیریت توکن‌های JWT.
- **`pkg/database/`**: مدیریت اتصال به پایگاه داده و عملیات پایه.

## نحوه راه‌اندازی و اجرا

این پروژه با Docker Compose به راحتی قابل اجرا است و نیازی به نصب پیش‌نیازهای اضافی روی سیستم شما نیست.

1.  **کلون کردن پروژه**:
    ابتدا، مخزن پروژه را از گیت‌هاب کلون کنید:
    ```
    git clone [https://github.com/amingeek/user-go.git](https://github.com/amingeek/user-go.git)
    cd user-go
    ```

2.  **اجرای با Docker Compose**:
    برای ساخت ایمیج‌ها و اجرای سرویس‌ها (برنامه Go و دیتابیس PostgreSQL)، دستور زیر را اجرا کنید:
    ```
    docker-compose up --build
    ```
    پس از اجرای این دستور، دو کانتینر برای برنامه و پایگاه داده ایجاد و اجرا می‌شوند. در لاگ‌های کنسول باید پیام `Server is running on port 8080...` را مشاهده کنید.

## راهنمای استفاده از API با `curl`

پس از اجرای موفقیت‌آمیز پروژه، می‌توانید از دستورات زیر برای تست مسیرهای API استفاده کنید.

### **۱. درخواست کد OTP**

یک کد یک‌بار مصرف برای شماره تلفن ارسال می‌کند. کد OTP تولید شده در لاگ‌های کنسول داکر نمایش داده می‌شود.
curl -X POST http://localhost:8080/otp/request

-H "Content-Type: application/json"

-d '{"phone_number": "+989123456789"}'


### **۲. ورود با کد OTP**

با استفاده از کد OTP دریافتی، احراز هویت انجام شده و یک توکن JWT برگردانده می‌شود. این توکن برای دسترسی به مسیرهای محافظت‌شده الزامی است.
curl -X POST http://localhost:8080/otp/login

-H "Content-Type: application/json"

-d '{"phone_number": "+989123456789", "otp": "<کد OTP اینجا قرار گیرد>"}'


### **۳. دریافت اطلاعات یک کاربر (مسیر محافظت‌شده)**

با استفاده از توکن JWT، اطلاعات کاربر با `ID=1` را دریافت می‌کند.
TOKEN="<توکن JWT را اینجا قرار دهید>"
curl -X GET http://localhost:8080/users/1

-H "Authorization: Bearer $TOKEN"


### **۴. دریافت لیست کاربران (مسیر محافظت‌شده)**

با استفاده از توکن، لیست کاربران را دریافت می‌کند.
TOKEN="<توکن JWT را اینجا قرار دهید>"
curl -X GET http://localhost:8080/users

-H "Authorization: Bearer $TOKEN"


## توجیه انتخاب پایگاه داده

**PostgreSQL** به عنوان پایگاه داده این پروژه انتخاب شده است. دلایل این انتخاب عبارتند از:
- **قابلیت اطمینان و پایداری**: PostgreSQL برای حجم بالای داده‌ها و تراکنش‌های پیچیده عملکرد بسیار پایداری دارد.
- **انعطاف‌پذیری**: با پشتیبانی از انواع داده‌های پیشرفته و قابلیت‌های توسعه‌پذیری، انتخاب مناسبی برای پروژه‌های در حال رشد است.
- **پشتیبانی از کانتینر**: وجود ایمیج‌های رسمی و بهینه PostgreSQL برای Docker، راه‌اندازی و مدیریت آن را بسیار ساده کرده است.